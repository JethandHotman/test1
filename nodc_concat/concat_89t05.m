%many_concat.m appends more than 2 EPIC files and updates attributes.
% Modified to only update minima and maxima in variables that already
% have those attributes.  Fran Hotchkiss 17 Feb 1999
% etm 04/21/06

% start with a fresh version of 44013-89t01-cal.nc
result=fcopy('44013_198901.nc','44013-89t01-cal.nc')
nccat('44013-89t01-cal.nc','44013_198902.nc','44013_198903.nc',...
   '44013_198904.nc','44013_198905.nc','44013_198906.nc',...
   '44013_198907.nc','44013_198908.nc','44013_198909.nc',...
   '44013_198910.nc','44013_198911.nc','44013_198912.nc',...
   '44013_199001.nc','44013_199002.nc','44013_199003.nc',...
   '44013_199004.nc','44013_199005.nc','44013_199006.nc',...
   '44013_199007.nc','44013_199008.nc','44013_199009.nc',...
   '44013_199010.nc','44013_199011.nc','44013_199012.nc',...
   '44013_199101.nc','44013_199102.nc','44013_199103.nc',...
   '44013_199104.nc','44013_199105.nc','44013_199106.nc',...
   '44013_199107.nc','44013_199108.nc','44013_199109.nc',...
   '44013_199110.nc','44013_199111.nc','44013_199112.nc',...
   '44013_199201.nc','44013_199202.nc','44013_199203.nc',...
   '44013_199204.nc','44013_199205.nc','44013_199206.nc',...
   '44013_199207.nc','44013_199208.nc','44013_199209.nc',...
   '44013_199210.nc','44013_199211.nc','44013_199212.nc')
 nc = netcdf('44013-89t01-cal.nc', 'write');

   nccat('44013-89t01-cal.nc','44013_199301.nc','44013_199302.nc','44013_199303.nc',...
   '44013_199304.nc','44013_199305.nc','44013_199306.nc',...
   '44013_199307.nc','44013_199308.nc','44013_199309.nc',...
   '44013_199310.nc','44013_199311.nc','44013_199312.nc',...
   '44013_199401.nc','44013_199402.nc','44013_199403.nc',...
   '44013_199404.nc','44013_199405.nc','44013_199406.nc',...
   '44013_199407.nc','44013_199408.nc','44013_199409.nc',...
   '44013_199410.nc','44013_199411.nc','44013_199412.nc',...
   '44013_199501.nc','44013_199502.nc','44013_199503.nc',...
   '44013_199504.nc','44013_199505.nc','44013_199506.nc',...
   '44013_199507.nc','44013_199508.nc','44013_199509.nc',...
   '44013_199510.nc','44013_199511.nc','44013_199512.nc',...
   '44013_199601.nc','44013_199602.nc','44013_199603.nc',...
   '44013_199604.nc','44013_199605.nc','44013_199606.nc',...
   '44013_199607.nc','44013_199608.nc','44013_199609.nc',...
   '44013_199610.nc','44013_199611.nc','44013_199612.nc',...
   '44013_199701.nc','44013_199702.nc','44013_199703.nc',...
   '44013_199704.nc','44013_199705.nc','44013_199706.nc',...
   '44013_199707.nc','44013_199711.nc','44013_199712.nc')
 nc = netcdf('44013-89t01-cal.nc', 'write');

   nccat('44013-89t01-cal.nc','44013_199801.nc','44013_199802.nc','44013_199803.nc',...
   '44013_199804.nc','44013_199805.nc','44013_199806.nc',...
   '44013_199807.nc','44013_199808.nc','44013_199809.nc',...
   '44013_199810.nc','44013_199811.nc','44013_199812.nc',...
   '44013_199901.nc','44013_199902.nc','44013_199903.nc',...
   '44013_199904.nc','44013_199905.nc','44013_199906.nc',...
   '44013_199907.nc','44013_199908.nc','44013_199909.nc',...
   '44013_199910.nc','44013_199911.nc','44013_199912.nc',...
   '44013_200001.nc','44013_200002.nc','44013_200003.nc',...
   '44013_200004.nc','44013_200005.nc','44013_200006.nc',...
   '44013_200007.nc','44013_200008.nc','44013_200009.nc',...
   '44013_200010.nc','44013_200011.nc','44013_200012.nc',...
   '44013_200101.nc','44013_200102.nc','44013_200103.nc',...
   '44013_200104.nc','44013_200105.nc','44013_200106.nc',...
   '44013_200107.nc','44013_200108.nc','44013_200109.nc',...
   '44013_200110.nc','44013_200111.nc','44013_200112.nc')

nc = netcdf('44013-89t01-cal.nc', 'write');

% now append Fran's 2002-2005 to my 89-01
result=fcopy('44013-89t01-cal.nc','44013-89t05-cal.nc')
nccat('44013-89t05-cal.nc','44013a2002.nc')
nc = netcdf('44013-89t05-cal.nc', 'write');


if isempty(nc), return, end
nctime = nc{'time'}(:);
nctime2 = nc{'time2'}(:);
ncstime = ep_datenum([nctime(1) nctime2(1)]);
ncn = length(nctime);
ncltime = ep_datenum([nctime(ncn) nctime2(ncn)]);

nc.COMPOSITE = ncdouble(1);
nc.start_time = datestr(ncstime,0);
nc.stop_time = datestr(ncltime,0);
nc.CREATION_DATE = ncchar(datestr(now,0));
history = ['Concatenation of files 44013_1989.nc through 44013_2001.nc : then concatenation of 2002-2005' nc.history(:)];
nc.history = ncchar(history);
nc{'time'}.type = ncchar('UNEVEN');
nc{'time2'}.type = ncchar('UNEVEN');

% Update variable min/max.
ncrecvar = recvar(nc);
for i = [1:length(ncrecvar)]
   ivarname = name(ncrecvar{i})
   if (~isempty(nc{ivarname}.minimum(:)))
      data = nc{ivarname}(:);
	   nc{ivarname}.minimum = ncfloat(min(data));
      nc{ivarname}.maximum = ncfloat(max(data));
   end
end
ncclose
